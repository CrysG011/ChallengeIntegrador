<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITEM</title>
    <link rel="icon" type="image/svg+xml" href="/img/branding/isotype.svg">
    <link rel="stylesheet" href="../../css/style.css">
</head>

<body>
    <%- include("./partials/header-shop") %>
        <main class="mainitem">
            <section class="destacado">
                <article class="destacado__card-item">
                    <picture class="destacado__img collection__cover">
                        <img class="card-item__img--front" src="/uploads/<%=producto.id%>-1.webp"
                            alt="Figura coleccionable Funko de <%=producto.product_name%> de la serie <%=categoria.category_name%>" />
                    </picture>
                    <div class="destacado__desc">
                        <h3 class="destacado__title"><%- (producto.product_name).toUpperCase() %></h3>
                        <p class="destacado__p">
                            <%- producto.product_description %>
                        </p>
                        <p class="destacado__price">$ <%- producto.price %></p>
                        <form id="addToCartForm" action="/shop/item/<%- producto.id %>/add" method="post">
                            <div class="destacado__controls">
                                <div class="controls-quantity">
                                    <input name="quantity" class="quantity-input" type="number" value="1">
                                    <button class="quantity-button" data-action="decrease">-</button>
                                    <button class="quantity-button" data-action="increase">+</button>
                                </div>
                                <button type="submit" class="btn-add btn-ingresar">Agregar al carrito</button>
                            </div>
                        </form>
                        <div class="destacado__pagos">
                            <a href="#" class="destacado__payment-link">Ver método de pago </a>
                            <p><%- (producto.dues).toUpperCase() %></p>
                        </div>
                    </div>

                </article>
            </section>
            <h4 class="slider__title">PRODUCTOS RELACIONADOS</h4>
            <section class="slider__item">
                <%productosRelacionados.forEach(producto=> { %>
                    <article class="card__item">
                        <a href="./<%=producto.id%>">
                            <picture class="card-item__cover">
                                <img class="card-item__img--front" src="/uploads/<%=producto.id%>-1.webp"
                                    alt="<%= (producto.product_name).toUpperCase() %>" />
                            </picture>
                            <div class="card-item__content">
                                <p class="card-item__licence">
                                    <%= (categoria.category_name).toUpperCase() %>
                                </p>
                                <h4 class="card-item__name">
                                    <%= (producto.product_name).toUpperCase() %>
                                </h4>
                                <p class="card-item__price">$ <%= producto.product_price %>
                                </p>
                                <p class="card-item__promo">
                                    <%= producto.dues %>
                                </p>
                            </div>
                        </a>
                    </article>
                    <% }) %>
            </section>
        </main>
        <%- include("./partials/footer-shop") %>
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    const addToCartForm = document.getElementById('addToCartForm');

                    addToCartForm.addEventListener('submit', function (e) {
                        e.preventDefault();

                        const quantityValue = parseInt(document.querySelector('.destacado__quantity-input').value);
                        fetch('/shop/item/<%= producto.id %>/add', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ quantity: quantityValue })
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    const mensajeElemento = document.createElement('div');
                                    mensajeElemento.innerHTML = 'Añadido al carrito exitosamente';

                                    const contenedor = document.querySelector('.destacado');
                                    contenedor.insertBefore(mensajeElemento, contenedor.firstChild);

                                    setTimeout(function () {
                                        mensajeElemento.remove();
                                    }, 4000);

                                } else {
                                    console.error('Error al agregar el producto al carrito', data.error);
                                }
                            })
                            .catch(error => {
                                console.error('Error al agregar el producto al carrito', error);
                            });

                        addToCartForm.reset();
                    });
                });
            </script>

</body>

</html>